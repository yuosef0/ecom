-- ============================================
-- ๐ ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช - ุฅุถุงูุฉ ุงูููุงุณุงุช ูุงูุฃููุงู ูุงูุตูุฑ ุงููุชุนุฏุฏุฉ
-- Database Update - Add Sizes, Colors, Multiple Images
-- ============================================

-- ============================================
-- โ ุงูุฎุทูุฉ 1: ุฅุถุงูุฉ ุจูุงูุงุช ููู Categories (ุงูุฃูุณุงู)
-- ============================================

-- ุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ ูู categories
TRUNCATE TABLE categories CASCADE;

-- ุฅุถุงูุฉ ุงูุฃูุณุงู ุงูุฑุฆูุณูุฉ
INSERT INTO categories (name, slug, description, display_order, is_active) VALUES
('ุฑุฌุงูู', 'men', 'ููุงุจุณ ูููุชุฌุงุช ุฑุฌุงููุฉ', 1, true),
('ุญุฑููู', 'women', 'ููุงุจุณ ูููุชุฌุงุช ุญุฑููู', 2, true),
('ุฃุทูุงูู', 'kids', 'ููุงุจุณ ูููุชุฌุงุช ุฃุทูุงู', 3, true),
('ุฅูุณุณูุงุฑุงุช', 'accessories', 'ุฅูุณุณูุงุฑุงุช ูุชููุนุฉ', 4, true);


-- ============================================
-- โ ุงูุฎุทูุฉ 2: ุชุญุฏูุซ ุฌุฏูู ุงูููุชุฌุงุช (ุฅุถุงูุฉ ุฃุนูุฏุฉ ุฌุฏูุฏุฉ)
-- ============================================

-- ุฅุถุงูุฉ ุนููุฏ sizes (ุงูููุงุณุงุช) - ูุตูููุฉ JSON
ALTER TABLE products
ADD COLUMN IF NOT EXISTS sizes JSONB DEFAULT '[]'::jsonb;

-- ุฅุถุงูุฉ ุนููุฏ colors (ุงูุฃููุงู) - ูุตูููุฉ JSON
ALTER TABLE products
ADD COLUMN IF NOT EXISTS colors JSONB DEFAULT '[]'::jsonb;

-- ุชุญุฏูุซ ุนููุฏ images ููููู ูุตูููุฉ JSON (ุฅุฐุง ูู ููู)
-- ูุฐุง ุงูุนููุฏ ููุฌูุฏ ุจุงููุนู ูู ุงูู schema ุงูุฃุตูู

-- ุฅุถุงูุฉ ุชุนูููุงุช ุนูู ุงูุฃุนูุฏุฉ ุงูุฌุฏูุฏุฉ
COMMENT ON COLUMN products.sizes IS 'ุงูููุงุณุงุช ุงููุชุงุญุฉ ููููุชุฌ (ูุตูููุฉ JSON): ["S", "M", "L", "XL"]';
COMMENT ON COLUMN products.colors IS 'ุงูุฃููุงู ุงููุชุงุญุฉ ููููุชุฌ (ูุตูููุฉ JSON): [{"name": "ุฃุญูุฑ", "hex": "#FF0000"}]';
COMMENT ON COLUMN products.images IS 'ูุตูููุฉ ูู ุฑูุงุจุท ุงูุตูุฑ (JSON): ["url1", "url2", "url3"]';


-- ============================================
-- โ ุงูุฎุทูุฉ 3: ุชุญุฏูุซ ุงูููุชุฌุงุช ุงูููุฌูุฏุฉ
-- ============================================

-- ุชุญููู image_url ุงูููุฌูุฏุฉ ุฅูู ูุตูููุฉ ูู images
UPDATE products
SET images = CASE
  WHEN image_url IS NOT NULL AND image_url != '' THEN
    jsonb_build_array(image_url)
  ELSE
    '[]'::jsonb
END
WHERE images = '[]'::jsonb OR images IS NULL;

-- ุฅุถุงูุฉ ููุงุณุงุช ุงูุชุฑุงุถูุฉ ููููุชุฌุงุช ุงูููุฌูุฏุฉ
UPDATE products
SET sizes = '["S", "M", "L", "XL"]'::jsonb
WHERE sizes = '[]'::jsonb OR sizes IS NULL;

-- ุฅุถุงูุฉ ุฃููุงู ุงูุชุฑุงุถูุฉ ููููุชุฌุงุช ุงูููุฌูุฏุฉ
UPDATE products
SET colors = '[
  {"name": "ุฃุจูุถ", "hex": "#FFFFFF"},
  {"name": "ุฃุณูุฏ", "hex": "#000000"},
  {"name": "ุฃุฒุฑู", "hex": "#0000FF"}
]'::jsonb
WHERE colors = '[]'::jsonb OR colors IS NULL;


-- ============================================
-- ๐ ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงูุชุญุฏูุซุงุช
-- ============================================

-- ุนุฑุถ ุงูุฃูุณุงู ุงูุฌุฏูุฏุฉ
SELECT
  id,
  name AS "ุงุณู ุงููุณู",
  slug AS "ุงูุฑุงุจุท",
  display_order AS "ุงูุชุฑุชูุจ",
  is_active AS "ูุดุท"
FROM categories
ORDER BY display_order;

-- ุนุฑุถ ุจููุฉ ุฌุฏูู ุงูููุชุฌุงุช ุงููุญุฏุซุฉ
SELECT
  column_name AS "ุงุณู ุงูุนููุฏ",
  data_type AS "ููุน ุงูุจูุงูุงุช",
  CASE
    WHEN is_nullable = 'YES' THEN 'ูุนู'
    ELSE 'ูุง'
  END AS "ููุจู NULL",
  column_default AS "ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ"
FROM information_schema.columns
WHERE table_schema = 'public'
AND table_name = 'products'
AND column_name IN ('sizes', 'colors', 'images', 'category_id', 'image_url')
ORDER BY ordinal_position;

-- ุนุฑุถ ุนููุฉ ูู ุงูููุชุฌุงุช ูุน ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ
SELECT
  id,
  title AS "ุงุณู ุงูููุชุฌ",
  category_id AS "ุงููุณู",
  jsonb_array_length(sizes) AS "ุนุฏุฏ ุงูููุงุณุงุช",
  jsonb_array_length(colors) AS "ุนุฏุฏ ุงูุฃููุงู",
  jsonb_array_length(images) AS "ุนุฏุฏ ุงูุตูุฑ"
FROM products
LIMIT 5;


-- ============================================
-- ๐ ุชูุฑูุฑ ุดุงูู
-- ============================================

SELECT
  '1. ุงูุฃูุณุงู ุชู ุฅุถุงูุชูุง' AS "ุงููุญุต",
  CASE
    WHEN (SELECT COUNT(*) FROM categories) >= 3 THEN
      'โ ูุนู - ' || (SELECT COUNT(*)::text FROM categories) || ' ูุณู'
    ELSE
      'โ ูุง - ููุท ' || (SELECT COUNT(*)::text FROM categories) || ' ูุณู'
  END AS "ุงููุชูุฌุฉ"

UNION ALL

SELECT
  '2. ุนููุฏ sizes ุชู ุฅุถุงูุชู' AS "ุงููุญุต",
  CASE
    WHEN EXISTS (
      SELECT 1 FROM information_schema.columns
      WHERE table_name = 'products' AND column_name = 'sizes'
    ) THEN 'โ ูุนู'
    ELSE 'โ ูุง'
  END AS "ุงููุชูุฌุฉ"

UNION ALL

SELECT
  '3. ุนููุฏ colors ุชู ุฅุถุงูุชู' AS "ุงููุญุต",
  CASE
    WHEN EXISTS (
      SELECT 1 FROM information_schema.columns
      WHERE table_name = 'products' AND column_name = 'colors'
    ) THEN 'โ ูุนู'
    ELSE 'โ ูุง'
  END AS "ุงููุชูุฌุฉ"

UNION ALL

SELECT
  '4. ุงูููุชุฌุงุช ูุฏููุง ููุงุณุงุช' AS "ุงููุญุต",
  CASE
    WHEN (
      SELECT COUNT(*)
      FROM products
      WHERE sizes != '[]'::jsonb AND sizes IS NOT NULL
    ) > 0 THEN
      'โ ูุนู - ' || (
        SELECT COUNT(*)::text
        FROM products
        WHERE sizes != '[]'::jsonb
      ) || ' ููุชุฌ'
    ELSE 'โ ูุง'
  END AS "ุงููุชูุฌุฉ"

UNION ALL

SELECT
  '5. ุงูููุชุฌุงุช ูุฏููุง ุฃููุงู' AS "ุงููุญุต",
  CASE
    WHEN (
      SELECT COUNT(*)
      FROM products
      WHERE colors != '[]'::jsonb AND colors IS NOT NULL
    ) > 0 THEN
      'โ ูุนู - ' || (
        SELECT COUNT(*)::text
        FROM products
        WHERE colors != '[]'::jsonb
      ) || ' ููุชุฌ'
    ELSE 'โ ูุง'
  END AS "ุงููุชูุฌุฉ";


-- ============================================
-- ๐ ููุงุญุธุงุช ูููุฉ
-- ============================================

/*
โ ูุง ุชู ุฅุถุงูุชู:
==================

1. ุงูุฃูุณุงู (Categories):
   - ุฑุฌุงูู (men)
   - ุญุฑููู (women)
   - ุฃุทูุงูู (kids)
   - ุฅูุณุณูุงุฑุงุช (accessories)

2. ุฃุนูุฏุฉ ุฌุฏูุฏุฉ ูู ุฌุฏูู products:
   - sizes: ูุตูููุฉ JSON ููููุงุณุงุช
     ูุซุงู: ["S", "M", "L", "XL", "2XL"]

   - colors: ูุตูููุฉ JSON ููุฃููุงู
     ูุซุงู: [
       {"name": "ุฃุญูุฑ", "hex": "#FF0000"},
       {"name": "ุฃุฒุฑู", "hex": "#0000FF"}
     ]

   - images: ูุตูููุฉ JSON ููุตูุฑ (ููุฌูุฏ ุจุงููุนู)
     ูุซุงู: [
       "url1.jpg",
       "url2.jpg",
       "url3.jpg"
     ]


๐ ููููุฉ ุงูุงุณุชุฎุฏุงู:
===================

1. ุนูุฏ ุฅุถุงูุฉ ููุชุฌ:
   ```javascript
   {
     title: "ุชูุดูุฑุช ุฑุฌุงูู",
     category_id: "uuid-of-men-category",
     sizes: ["S", "M", "L", "XL"],
     colors: [
       {name: "ุฃุญูุฑ", hex: "#FF0000"},
       {name: "ุฃุฒุฑู", hex: "#0000FF"}
     ],
     images: ["url1.jpg", "url2.jpg", "url3.jpg"]
   }
   ```

2. ุนูุฏ ุนุฑุถ ุงูููุชุฌ:
   - ุงุนุฑุถ ูู ุงูุตูุฑ ูู carousel/gallery
   - ุงุนุฑุถ ุงูููุงุณุงุช ูุฃุฒุฑุงุฑ ููุงุฎุชูุงุฑ
   - ุงุนุฑุถ ุงูุฃููุงู ูุฏูุงุฆุฑ ููููุฉ


๐จ ูุซุงู ุนูู ุงูุจูุงูุงุช:
=====================

ุงูุฃูุณุงู:
| id | name     | slug         |
|----|----------|--------------|
| 1  | ุฑุฌุงูู    | men          |
| 2  | ุญุฑููู    | women        |
| 3  | ุฃุทูุงูู   | kids         |
| 4  | ุฅูุณุณูุงุฑุงุช| accessories  |

ููุชุฌ:
{
  "title": "ุชูุดูุฑุช ูุทู ุฑุฌุงูู",
  "category_id": "uuid-men",
  "sizes": ["S", "M", "L", "XL", "2XL"],
  "colors": [
    {"name": "ุฃุจูุถ", "hex": "#FFFFFF"},
    {"name": "ุฃุณูุฏ", "hex": "#000000"},
    {"name": "ูุญูู", "hex": "#000080"}
  ],
  "images": [
    "image1.jpg",
    "image2.jpg",
    "image3.jpg"
  ]
}


โ๏ธ ุชุญุฐูุฑ:
=========

- ุชู ุญุฐู ุฌููุน ุงูุฃูุณุงู ุงููุฏููุฉ (TRUNCATE)
- ุชู ุชุญุฏูุซ ุงูููุชุฌุงุช ุงูููุฌูุฏุฉ ุจููุงุณุงุช ูุฃููุงู ุงูุชุฑุงุถูุฉ
- ูู ูุชุฃุซุฑ category_id ููููุชุฌุงุช ุงูููุฌูุฏุฉ (ุณูููู NULL)
- ูุฌุจ ุฅุนุงุฏุฉ ุฑุจุท ุงูููุชุฌุงุช ุงููุฏููุฉ ุจุงูุฃูุณุงู ุงูุฌุฏูุฏุฉ ูุฏููุงู


๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ:
===================

1. โ ุดุบูู ูุฐุง ุงูููู ูู SQL Editor
2. โ ุชุญูู ูู ุงูุชูุฑูุฑ ุงูุดุงูู
3. โ ุงุฑุฌุน ููููุชุฌุงุช ุงููุฏููุฉ ูุญุฏุซ category_id
4. โ ุญุฏุซ ูุงุฌูุฉ ุงูุฃุฏูู ูุฅุถุงูุฉ ุงูููุชุฌุงุช
5. โ ุฃูุดุฆ ุตูุญุฉ ุชูุงุตูู ุงูููุชุฌ
*/


-- ============================================
-- ุชู ุงูุงูุชูุงุก! โ
-- ============================================

/*
๐ ุชู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ!

ุงูุขู ููููู:
โ ุฅุถุงูุฉ ููุชุฌุงุช ุจุฃูุณุงู ูุฎุชููุฉ
โ ุฅุถุงูุฉ ุฃูุซุฑ ูู ุตูุฑุฉ ููู ููุชุฌ
โ ุฅุถุงูุฉ ููุงุณุงุช ูุชุนุฏุฏุฉ
โ ุฅุถุงูุฉ ุฃููุงู ูุชุนุฏุฏุฉ

ุงูุชุงูู: ุชุญุฏูุซ ูุงุฌูุฉ ุงูุฃุฏูู! ๐
*/
