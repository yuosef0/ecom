# ๐ง ุญู ูุดููุฉ "new row violates row-level security policy" - ุฎุทูุฉ ุจุฎุทูุฉ

## โ๏ธ ุงููุดููุฉ
ููุง ุชุญุงูู ุชุถูู ููุชุฌุ ุจุชุธูุฑ ุงูุฑุณุงูุฉ ุฏู:
```
Error: new row violates row-level security policy
```

---

## โ ุงูุญู ุงููุงูู (5 ุฏูุงุฆู ููุท)

### ๐ ูุจู ูุง ุชุจุฏุฃ:
- ุชุฃูุฏ ุฅูู ูุณุฌู ุญุณุงุจ ูู ุงููููุน
- ุชุฃูุฏ ุฅูู ูุงุชุญ **Supabase Dashboard**
- ุฎูู ุนูุฏู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงููู ุณุฌูุช ุจูู ุฌุงูุฒ

---

## ๐ฏ ุงูุฎุทูุฉ 1: ุงูุชุญ SQL Editor ูู Supabase

1. ุงุฐูุจ ุฅูู: https://supabase.com
2. ุงุฎุชุงุฑ ูุดุฑูุนู
3. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุถุบุท ุนูู **SQL Editor**
4. ุงุถุบุท **New query**

---

## ๐ฏ ุงูุฎุทูุฉ 2: ุดุบูู ุงูุณูุฑูุจุช ุงูุชุดุฎูุตู

1. **ุงูุชุญ ููู** `diagnose-rls-issue.sql` ูู ูุฌูุฏ ุงููุดุฑูุน
2. **ุงูุณุฎ ูู ูุญุชูู ุงูููู**
3. **ุงูุตูู ูู SQL Editor**
4. **ุงุถุบุท Run** โถ๏ธ
5. **ุดูู ุงููุชุงูุฌ**

### ๐ ุงูุฑุฃ ุงูุชูุฑูุฑ ุงูุดุงูู ูู ุขุฎุฑ ุงููุชุงูุฌ:

ุณูุธูุฑ ูู ุฌุฏูู ูุซู ูุฐุง:

```
| check_name                  | status                           |
|----------------------------|----------------------------------|
| 1. ุฌุฏูู admins ููุฌูุฏ        | โ ูุนู                           |
| 2. ุฃูุช ูุณุฌู ุฏุฎูู            | โ ูุนู - yourmail@example.com    |
| 3. ุฃูุช ูุณุฌู ูุฃุฏูู           | โ ูุง - ุฃุถู ููุณู ูู ุฌุฏูู admins |
| 4. ุญุณุงุจู ูุดุท                | โ ูุง                            |
| 5. ุณูุงุณุงุช RLS ุตุญูุญุฉ         | โ ูุง - ุดุบูู update-rls...      |
| 6. ููููู ุฅุถุงูุฉ ููุชุฌุงุช       | โ ูุง - ุฑุงุฌุน ุงูุฎุทูุงุช ุงูุณุงุจูุฉ     |
```

---

## ๐ฏ ุงูุฎุทูุฉ 3: ุงูุญู ุงูุณุฑูุน

**ุงูุขู ุงุณุชุฎุฏู ุงูุญู ุงูุณุฑูุน ุงููุงูู:**

1. **ุงูุชุญ ููู** `quick-fix-rls.sql` ูู ูุฌูุฏ ุงููุดุฑูุน
2. **ูุจู ูุง ุชูุณุฎูุ ุงูุชุญู ูู ูุญุฑุฑ ูุตูุต**
3. **ุงุจุญุซ ุนู ุงูุณุทุฑ:**
   ```sql
   WHERE email = 'YOUR-EMAIL@EXAMPLE.COM'
   ```
4. **ุงุณุชุจุฏู** `YOUR-EMAIL@EXAMPLE.COM` **ุจุจุฑูุฏู ุงูุฅููุชุฑููู**
   - ูุซุงู: `WHERE email = 'mohamed@gmail.com'`
5. **ุงุญูุธ ุงูููู**
6. **ุงูุณุฎ ูู ูุญุชูู ุงูููู**
7. **ุงูุตูู ูู SQL Editor** ูู Supabase
8. **ุงุถุบุท Run** โถ๏ธ

### โ ูุฌุจ ุฃู ุชุฑู:
```
Success. Rows returned: 1
```

---

## ๐ฏ ุงูุฎุทูุฉ 4: ุชุญูู ูู ุงููุฌุงุญ

ูู ููุณ SQL Editorุ ููุฐ ูุฐุง ุงูุฃูุฑ:

```sql
SELECT
  email,
  role,
  is_active
FROM admins
WHERE user_id = auth.uid();
```

### โ ูุฌุจ ุฃู ูุธูุฑ:
```
| email              | role         | is_active |
|-------------------|--------------|-----------|
| your@email.com    | super_admin  | true      |
```

โ **ุฅุฐุง ุธูุฑุช ุจูุงูุงุชู = ุชูุงู! ููู ุงูุฎุทูุฉ 5**

โ **ุฅุฐุง ูู ูุธูุฑ ุดูุก = ุฑุงุฌุน ุงูุฎุทูุฉ 3 ูุชุฃูุฏ ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู**

---

## ๐ฏ ุงูุฎุทูุฉ 5: ุงุฎุชุจุฑ ุงูุญู

1. **ุณุฌู ุฎุฑูุฌ** ูู ุงููููุน
2. **ุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู** ุจููุณ ุงูุญุณุงุจ
3. **ุงุฐูุจ ุฅูู ููุญุฉ ุงูุฃุฏูู** โ **ุงูููุชุฌุงุช**
4. **ุงุถุบุท "ุฅุถุงูุฉ ููุชุฌ"**
5. **ุงููุฃ ุงูุจูุงูุงุช ูุงุถุบุท ุญูุธ**

### โ ูุฌุจ ุฃู ูุนูู ุงูุขู ุจุฏูู ุฃุฎุทุงุก! ๐

---

## โ ูู ูุณู ุงููุดููุฉ ููุฌูุฏุฉุ

### ุงูุณุจุจ ุงููุญุชูู 1: ูู ุชุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู
**ุงูุญู:** ุณุฌู ุฎุฑูุฌ ูุณุฌู ุฏุฎูู

### ุงูุณุจุจ ุงููุญุชูู 2: ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฎุทุฃ
**ุงูุญู:**
```sql
-- ุดูู ูู ุงููุณุชุฎุฏููู
SELECT id, email FROM auth.users ORDER BY created_at DESC LIMIT 5;

-- ุงุณุชุฎุฏู ุงูุจุฑูุฏ ุงูุตุญูุญ ูู quick-fix-rls.sql
```

### ุงูุณุจุจ ุงููุญุชูู 3: ุงููุดููุฉ ูู Storage (ุฑูุน ุงูุตูุฑ)
ุฅุฐุง ูุงูุช ุงููุดููุฉ ูู ุฑูุน ุงูุตูุฑ ููุท:
1. ุงุฐูุจ ุฅูู **Storage** ูู Supabase
2. ุฃูุดุฆ Bucket ุฌุฏูุฏ ุจุงุณู `product-images`
3. ุงุฌุนูู **Public**
4. ุฃุถู Policy:
   ```sql
   -- ุงุฐูุจ ุฅูู Policies ูู Storage
   CREATE POLICY "Allow public upload"
   ON storage.objects FOR INSERT
   TO public
   WITH CHECK (bucket_id = 'product-images');

   CREATE POLICY "Allow public read"
   ON storage.objects FOR SELECT
   TO public
   USING (bucket_id = 'product-images');
   ```

---

## ๐ฑ ุชูุงุตู ูุนู

ุฅุฐุง ุฌุฑุจุช ูู ุงูุฎุทูุงุช ููุณู ุงููุดููุฉ ููุฌูุฏุฉ:

1. **ุดุบูู** `diagnose-rls-issue.sql`
2. **ุงูุณุฎ ูุชุงุฆุฌ "ุงูุชูุฑูุฑ ุงูุดุงูู"**
3. **ุงูุณุฎ ูุต ุงูุฎุทุฃ ุงููุงูู ูู Console ูู ุงููุชุตูุญ**
4. **ุดุงุฑููู ูุนุงูุง**

ุณุฃุณุงุนุฏู ุฃุญู ุงููุดููุฉ! ๐ช

---

## โ ููุฎุต ุณุฑูุน

```bash
# ุงูุฎุทูุงุช ุจุงุฎุชุตุงุฑ:
1. ุดุบูู diagnose-rls-issue.sql โ ุดูู ุงููุดููุฉ
2. ุบููุฑ ุจุฑูุฏู ูู quick-fix-rls.sql
3. ุดุบูู quick-fix-rls.sql โ ุญู ุงููุดููุฉ
4. ุณุฌู ุฎุฑูุฌ ูุณุฌู ุฏุฎูู
5. ุฌุฑุจ ุฅุถุงูุฉ ููุชุฌ โ ูุฌุจ ุฃู ูุดุชุบู! ๐
```

---

## ๐ ุจุงูุชูููู!

ุงููุดููุฉ ุฏู ุดุงุฆุนุฉ ูุณููุฉ ุงูุญู. ุงุชุจุน ุงูุฎุทูุงุช ุจุงูุชุฑุชูุจ ููุชุดุชุบู ูุนุงู! ๐
