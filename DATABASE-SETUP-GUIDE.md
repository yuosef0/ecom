# ๐ ุฏููู ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงูุตูุฑ

ูุฐุง ุงูุฏููู ูุดุฑุญ ููููุฉ ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุงููุฉ ูููุชุฌุฑ ุงูุฅููุชุฑููู ูู ุงูุตูุฑ.

---

## ๐ ุงููุชุทูุจุงุช

- โ ุญุณุงุจ ุนูู Supabase
- โ ูุดุฑูุน Supabase ุฌุงูุฒ
- โ ุญุณุงุจ ูุณุฌู ูู ุงููููุน (ููุจุฑูุฏ ุงูุฅููุชุฑููู)

---

## ๐ฏ ุงูุฎุทูุงุช (5 ุฏูุงุฆู ููุท)

### ุงูุฎุทูุฉ 1๏ธโฃ: ุงูุชุญ SQL Editor

1. ุงุฐูุจ ุฅูู: https://supabase.com
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ: **SQL Editor**
4. ุงุถุบุท **New query**

---

### ุงูุฎุทูุฉ 2๏ธโฃ: ุดุบูู ููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

1. **ุงูุชุญ ููู** `complete-database-setup.sql` ูู ูุฌูุฏ ุงููุดุฑูุน
2. **ุงูุณุฎ ูู ูุญุชูู ุงูููู** (Ctrl+A ุซู Ctrl+C)
3. **ุงูุตูู ูู SQL Editor** (Ctrl+V)
4. **ุงุถุบุท Run** โถ๏ธ
5. **ุงูุชุธุฑ ุญุชู ููุชูู** (ูุฏ ูุฃุฎุฐ 5-10 ุซูุงูู)

### โ ูุฌุจ ุฃู ุชุฑู:
```
Success
```

ูุณุชุธูุฑ ูู ุฌุฏุงูู ุจุงูุฅุญุตุงุฆูุงุช ูู ุงูุฃุณูู.

---

### ุงูุฎุทูุฉ 3๏ธโฃ: ุฃุถู ููุณู ูุฃุฏูู

**ุงูุขู ุงูุฎุทูุฉ ุงูุฃูู!** ูุฌุจ ุฃู ุชุถูู ููุณู ูุฃุฏูู.

1. **ูู ููุณ SQL Editor**ุ ุงุญุฐู ุงูููุฏ ุงููุฏูู
2. **ุงูุณุฎ ูุงูุตู ุงูููุฏ ุงูุชุงูู:**

```sql
INSERT INTO admins (user_id, email, full_name, role)
SELECT
  id,
  email,
  raw_user_meta_data->>'full_name',
  'super_admin'
FROM auth.users
WHERE email = 'YOUR-EMAIL@EXAMPLE.COM'
ON CONFLICT (user_id) DO UPDATE
SET
  is_active = true,
  role = 'super_admin';
```

3. **โ๏ธ ุงุณุชุจุฏู** `'YOUR-EMAIL@EXAMPLE.COM'` **ุจุจุฑูุฏู ุงูุฅููุชุฑููู**

   **ูุซุงู:**
   ```sql
   WHERE email = 'mohamed@gmail.com'
   ```

4. **ุงุถุบุท Run** โถ๏ธ

### โ ูุฌุจ ุฃู ุชุฑู:
```
Success. Rows returned: 1
```

---

### ุงูุฎุทูุฉ 4๏ธโฃ: ุชุญูู ูู ุงููุฌุงุญ

ูู SQL Editorุ ููุฐ ูุฐุง ุงูุฃูุฑ:

```sql
SELECT
  email,
  role,
  is_active,
  'ุฃูุช ุงูุขู ุฃุฏูู! โ' AS status
FROM admins
WHERE user_id = auth.uid();
```

### โ ูุฌุจ ุฃู ูุธูุฑ:
```
| email              | role         | is_active | status           |
|-------------------|--------------|-----------|------------------|
| your@email.com    | super_admin  | true      | ุฃูุช ุงูุขู ุฃุฏูู! โ |
```

---

### ุงูุฎุทูุฉ 5๏ธโฃ: ุฌุฑุจ ุฅุถุงูุฉ ููุชุฌ

1. **ุณุฌู ุฎุฑูุฌ** ูู ุงููููุน
2. **ุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู**
3. **ุงุฏุฎู ููุญุฉ ุงูุฃุฏูู** โ **ุงูููุชุฌุงุช**
4. **ุงุถุบุท "ุฅุถุงูุฉ ููุชุฌ"**
5. **ุงููุฃ ุงูุจูุงูุงุช ูุงุถุบุท ุญูุธ**

### โ ูุฌุจ ุฃู ูุนูู ุจุฏูู ุฃุฎุทุงุก! ๐

---

## ๐ ูุง ุชู ุฅูุดุงุคูุ

### ุงูุฌุฏุงูู (7 ุฌุฏุงูู):
- โ **admins** - ุฌุฏูู ุงูุฃุฏูู
- โ **categories** - ุงููุฆุงุช
- โ **products** - ุงูููุชุฌุงุช
- โ **orders** - ุงูุทูุจุงุช
- โ **reviews** - ุงูุชููููุงุช
- โ **coupons** - ุงูููุจููุงุช
- โ **wishlists** - ุงูููุถูุฉ

### Functions (7 ุฏูุงู):
- โ `update_updated_at_column()` - ุชุญุฏูุซ ุชููุงุฆู
- โ `get_total_revenue()` - ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช
- โ `count_orders_by_status()` - ุนุฏุฏ ุงูุทูุจุงุช ุญุณุจ ุงูุญุงูุฉ
- โ `get_product_average_rating()` - ูุชูุณุท ุงูุชูููู
- โ `get_product_review_count()` - ุนุฏุฏ ุงูุชููููุงุช
- โ `is_admin()` - ุงูุชุญูู ูู ุงูุฃุฏูู
- โ `get_admin_role()` - ุงูุญุตูู ุนูู ุฏูุฑ ุงูุฃุฏูู

### Triggers (6 ูุดุบูุงุช):
- โ ุชุญุฏูุซ `updated_at` ุชููุงุฆูุงู ููู ุงูุฌุฏุงูู

### RLS Policies (ุณูุงุณุงุช ุงูุฃูุงู):
- โ **ุงููุฑุงุกุฉ:** ูุชุงุญุฉ ููุฌููุน
- โ **ุงูุฅุถุงูุฉ/ุงูุชุนุฏูู/ุงูุญุฐู:** ููุฃุฏูู ููุท
- โ **ุงูุทูุจุงุช:** ูููู ููุฌููุน ุฅูุดุงุคูุง
- โ **ุงูุชููููุงุช:** ูููู ููุฌููุน ูุชุงุจุชูุง

---

## ๐ ููุฎุต ุงูุณูุงุณุงุช

| ุงูุฌุฏูู | ุงููุฑุงุกุฉ | ุงูุฅุถุงูุฉ | ุงูุชุนุฏูู | ุงูุญุฐู |
|--------|---------|---------|---------|--------|
| **admins** | ุงูุฌููุน โ | ุงูุฌููุน โ | ุงูุฌููุน โ | ุงูุฌููุน โ |
| **categories** | ุงูุฌููุน โ | ุฃุฏูู ๐ | ุฃุฏูู ๐ | ุฃุฏูู ๐ |
| **products** | ุงูุฌููุน โ | ุฃุฏูู ๐ | ุฃุฏูู ๐ | ุฃุฏูู ๐ |
| **orders** | ุงูุฌููุน โ | ุงูุฌููุน โ | ุฃุฏูู ๐ | ุฃุฏูู ๐ |
| **reviews** | ุงูุฌููุน โ | ุงูุฌููุน โ | ุฃุฏูู ๐ | ุฃุฏูู ๐ |
| **coupons** | ุงูุฌููุน โ | ุฃุฏูู ๐ | ุฃุฏูู ๐ | ุฃุฏูู ๐ |
| **wishlists** | ุงูุฌููุน โ | ุงูุฌููุน โ | ุงูุฌููุน โ | ุงูุฌููุน โ |

---

## โ ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### ุงููุดููุฉ 1: "relation admins already exists"

**ุงูุณุจุจ:** ุงูุฌุฏูู ููุฌูุฏ ุจุงููุนู

**ุงูุญู:**
```sql
-- ุงุญุฐู ุงูุฌุฏุงูู ุงููุฏููุฉ ุฃููุงู
DROP TABLE IF EXISTS wishlists CASCADE;
DROP TABLE IF EXISTS reviews CASCADE;
DROP TABLE IF EXISTS coupons CASCADE;
DROP TABLE IF EXISTS orders CASCADE;
DROP TABLE IF EXISTS products CASCADE;
DROP TABLE IF EXISTS categories CASCADE;
DROP TABLE IF EXISTS admins CASCADE;
```

ุซู ุดุบูู `complete-database-setup.sql` ูุฑุฉ ุฃุฎุฑู.

---

### ุงููุดููุฉ 2: "auth.uid() returns null"

**ุงูุณุจุจ:** ูุณุช ูุณุฌู ุฏุฎูู ูู Supabase

**ุงูุญู:**
1. ุณุฌู ุฏุฎูู ูู ุงููููุน
2. ุงูุชุญ Console ูู ุงููุชุตูุญ (F12)
3. ููุฐ:
   ```javascript
   console.log(supabase.auth.getUser())
   ```
4. ุชุฃูุฏ ูู ูุฌูุฏ ุจูุงูุงุช ุงููุณุชุฎุฏู

---

### ุงููุดููุฉ 3: "new row violates row-level security policy"

**ุงูุณุจุจ:** ูู ุชุถู ููุณู ูุฃุฏูู

**ุงูุญู:**
1. ููุฐ ุงูุฎุทูุฉ 3 ูุฑุฉ ุฃุฎุฑู (ุฅุถุงูุฉ ููุณู ูุฃุฏูู)
2. ุณุฌู ุฎุฑูุฌ ูุณุฌู ุฏุฎูู
3. ุฌุฑุจ ูุฑุฉ ุฃุฎุฑู

---

### ุงููุดููุฉ 4: "Email not found in auth.users"

**ุงูุณุจุจ:** ูู ุชุณุฌู ุญุณุงุจ ูู ุงููููุน ุจุนุฏ

**ุงูุญู:**
1. ุงูุชุญ ุงููููุน
2. ุงุถุบุท "ุฅูุดุงุก ุญุณุงุจ"
3. ุณุฌู ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู
4. ุงุฑุฌุน ููุฎุทูุฉ 3 ูุฃุถู ููุณู ูุฃุฏูู

---

## ๐งช ุงุฎุชุจุงุฑุงุช ููุชุญูู

### ุงุฎุชุจุงุฑ 1: ุงูุชุญูู ูู ุงูุฌุฏุงูู

```sql
SELECT tablename
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY tablename;
```

**ูุฌุจ ุฃู ูุธูุฑ:** 7 ุฌุฏุงูู

---

### ุงุฎุชุจุงุฑ 2: ุงูุชุญูู ูู Functions

```sql
SELECT routine_name
FROM information_schema.routines
WHERE routine_type = 'FUNCTION'
AND routine_schema = 'public'
ORDER BY routine_name;
```

**ูุฌุจ ุฃู ูุธูุฑ:** 7 functions

---

### ุงุฎุชุจุงุฑ 3: ุงูุชุญูู ูู ุฃูู ุฃุฏูู

```sql
SELECT
  email,
  role,
  is_active
FROM admins
WHERE user_id = auth.uid();
```

**ูุฌุจ ุฃู ูุธูุฑ:** ุจูุงูุงุชู

---

### ุงุฎุชุจุงุฑ 4: ุงูุชุญูู ูู ุงูุณูุงุณุงุช

```sql
SELECT
  tablename,
  policyname,
  cmd
FROM pg_policies
WHERE tablename = 'products'
ORDER BY cmd;
```

**ูุฌุจ ุฃู ูุธูุฑ:** 4 ุณูุงุณุงุช (SELECT, INSERT, UPDATE, DELETE)

---

## ๐ ุฎุทูุงุช ุงุฎุชูุงุฑูุฉ

### 1. ุฅูุดุงุก Storage Bucket ููุตูุฑ

```sql
-- ุงุฐูุจ ุฅูู Storage ูู Supabase
-- ุฃูุดุฆ bucket ุฌุฏูุฏ:
--   Name: product-images
--   Public: Yes
```

ุซู ุฃุถู Policies:

```sql
-- Policy ูููุฑุงุกุฉ
CREATE POLICY "Allow public read"
ON storage.objects FOR SELECT
TO public
USING (bucket_id = 'product-images');

-- Policy ููุฅุถุงูุฉ
CREATE POLICY "Allow admins to upload"
ON storage.objects FOR INSERT
TO authenticated
WITH CHECK (
  bucket_id = 'product-images'
  AND EXISTS (
    SELECT 1 FROM public.admins
    WHERE user_id = auth.uid()
    AND is_active = true
  )
);
```

---

### 2. ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ

```sql
-- ุฅุถุงูุฉ ูุฆุงุช ุชุฌุฑูุจูุฉ
INSERT INTO categories (name, slug, description, display_order) VALUES
('ุฅููุชุฑูููุงุช', 'electronics', 'ุฃุฌูุฒุฉ ุฅููุชุฑูููุฉ ูุชููุนุฉ', 1),
('ููุงุชู', 'phones', 'ููุงุชู ุฐููุฉ ูููุญูุงุช', 2),
('ุญูุงุณูุจ', 'computers', 'ูุงุจุชูุจุงุช ูุฃุฌูุฒุฉ ููุจููุชุฑ', 3);

-- ุฅุถุงูุฉ ููุชุฌุงุช ุชุฌุฑูุจูุฉ
INSERT INTO products (title, slug, description, price, stock, is_featured, category_id) VALUES
('ูุงุชู iPhone 15 Pro', 'iphone-15-pro', 'ุฃุญุฏุซ ูุงุชู ูู Apple', 52999.00, 15, true,
  (SELECT id FROM categories WHERE slug = 'phones')),
('ูุงุจุชูุจ Dell XPS 13', 'dell-xps-13', 'ูุงุจุชูุจ ููู ููุญููู', 45000.00, 8, true,
  (SELECT id FROM categories WHERE slug = 'computers'));
```

---

## โ ุงูุฎูุงุตุฉ

```bash
# ุงูุฎุทูุงุช ุจุงุฎุชุตุงุฑ:
1. ุดุบูู complete-database-setup.sql ูู SQL Editor
2. ุฃุถู ููุณู ูุฃุฏูู (ุบูุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู!)
3. ุณุฌู ุฎุฑูุฌ ูุณุฌู ุฏุฎูู
4. ุฌุฑุจ ุฅุถุงูุฉ ููุชุฌ
5. ูู ุดูุก ูุฌุจ ุฃู ูุนูู! ๐
```

---

## ๐ ุฅุฐุง ุงุญุชุฌุช ูุณุงุนุฏุฉ

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุดุบูู `diagnose-rls-issue.sql` ููุนุฑูุฉ ุงููุดููุฉ
2. ุฑุงุฌุน ูุณู "ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ" ุฃุนูุงู
3. ุชุฃูุฏ ูู ุฅุถุงูุฉ ููุณู ูุฃุฏูู
4. ุดุงุฑู ูุต ุงูุฎุทุฃ ุงููุงูู

---

**ุจุงูุชูููู! ๐**
