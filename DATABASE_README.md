# ๐๏ธ ุฏููู ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูุฏููู ูุดุฑุญ ููููุฉ ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุงููุฉ ููุชุฌุฑู ุงูุฅููุชุฑููู ุจุงุณุชุฎุฏุงู ููู ูุงุญุฏ ููุท.

---

## โก ุงูุทุฑููุฉ ุงูุณุฑูุนุฉ (ุฎุทูุฉ ูุงุญุฏุฉ)

### 1. ุงูุชุญ Supabase SQL Editor

ุงุฐูุจ ุฅูู: [https://app.supabase.com](https://app.supabase.com) โ ุงุฎุชุฑ ูุดุฑูุนู โ SQL Editor

### 2. ุงูุณุฎ ูุดุบูู ุงูููุฏ

```bash
# ุงูุชุญ ููู database-setup.sql
# ุงูุณุฎ ุงููุญุชูู ูุงููุงู
# ุงูุตูู ูู SQL Editor
# ุงุถุบุท RUN โถ๏ธ
```

**ูุฐุง ูู ุดูุก!** โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฌุงูุฒุฉ ุงูุขู.

---

## ๐ฆ ูุง ูุญุชููู ููู `database-setup.sql`

### 1๏ธโฃ ุงูุฌุฏุงูู (10 ุฌุฏุงูู):
- โ `products` - ุงูููุชุฌุงุช
- โ `categories` - ุงููุฆุงุช
- โ `orders` - ุงูุทูุจุงุช
- โ `profiles` - ุงููููุงุช ุงูุดุฎุตูุฉ ูููุณุชุฎุฏููู
- โ `admins` - ุงููุณุคูููู
- โ `wishlist` - ูุงุฆูุฉ ุงูุฃูููุงุช
- โ `coupons` - ุงูููุจููุงุช
- โ `coupon_usage` - ุณุฌู ุงุณุชุฎุฏุงู ุงูููุจููุงุช
- โ `top_bar_messages` - ุฑุณุงุฆู ุงูุดุฑูุท ุงูุนููู
- โ `theme_settings` - ุฅุนุฏุงุฏุงุช ุงูุซูู ูุงูุฃููุงู

### 2๏ธโฃ ุงูููุงุฑุณ (Indexes):
- ููุงุฑุณ ูุชุญุณูู ุฃุฏุงุก ุงูุจุญุซ ูุงูุงุณุชุนูุงูุงุช

### 3๏ธโฃ ุงูุฏูุงู (Functions):
- `is_admin()` - ููุชุญูู ูู ุตูุงุญูุงุช ุงููุณุคูู
- `update_updated_at_column()` - ูุชุญุฏูุซ ููุช ุงูุชุนุฏูู ุชููุงุฆูุงู

### 4๏ธโฃ ุงููุญูุฒุงุช (Triggers):
- ุชุญุฏูุซ `updated_at` ุชููุงุฆูุงู ุนูุฏ ุชุนุฏูู ุฃู ุณุฌู

### 5๏ธโฃ ุณูุงุณุงุช ุงูุฃูุงู (RLS Policies):
- ุญูุงูุฉ ุฌููุน ุงูุฌุฏุงูู
- ุตูุงุญูุงุช ูููุตูุฉ ูููุณุชุฎุฏููู ูุงููุณุคูููู

### 6๏ธโฃ ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ:
- ุฅุนุฏุงุฏุงุช ุงูุซูู (6 ุฃููุงู)
- ุฑุณุงูุฉ ุชุฑุญูุจูุฉ ูู ุงูุดุฑูุท ุงูุนููู

---

## ๐ ุงูุฎุทูุฉ ุงูุชุงููุฉ: ุฅุถุงูุฉ ุฃูู ูุณุคูู

ุจุนุฏ ุชุดุบูู ููู `database-setup.sql`ุ ุชุญุชุงุฌ ูุฅุถุงูุฉ ููุณู ููุณุคูู:

### ุงูุทุฑููุฉ 1: ุจุงุณุชุฎุฏุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

```sql
-- 1. ุณุฌู ุญุณุงุจ ูู ุงููููุน ุฃููุงู
-- 2. ุซู ุดุบูู ูุฐุง ุงูููุฏ:

INSERT INTO admins (user_id, email, full_name, role)
SELECT
  id,
  email,
  raw_user_meta_data->>'full_name',
  'super_admin'
FROM auth.users
WHERE email = 'your-email@example.com';
```

### ุงูุทุฑููุฉ 2: ุจุงุณุชุฎุฏุงู UUID ูุจุงุดุฑุฉ

```sql
-- 1. ุงุญุตู ุนูู UUID ูู: Authentication โ Users
-- 2. ุดุบูู ุงูููุฏ:

INSERT INTO admins (user_id, email, full_name, role)
VALUES (
  'USER-UUID-HERE',
  'admin@example.com',
  'ุงุณูู ููุง',
  'super_admin'
);
```

---

## ๐ฆ ุฅุนุฏุงุฏ Storage (ุฑูุน ุงูุตูุฑ)

### ูุฏููุงู ูู Dashboard (ููุตู ุจู):

1. ุงุฐูุจ ุฅูู **Storage** ูู Supabase Dashboard
2. ุงุถุบุท **Create a new bucket**
3. ุงุณู ุงูู bucket: `products-images`
4. โ ูุนูู: **Public bucket**
5. ุงุถุบุท **Create**

### ุงูุณูุงุณุงุช (Policies) ููู Storage:

ุจุนุฏ ุฅูุดุงุก ุงูู bucketุ ุฃุถู ูุฐู ุงูุณูุงุณุงุช:

```sql
-- ุงูุณูุงุญ ููุฌููุน ุจูุดุงูุฏุฉ ุงูุตูุฑ
CREATE POLICY "ุงูุฌููุน ูููููู ุฑุคูุฉ ุตูุฑ ุงูููุชุฌุงุช"
ON storage.objects FOR SELECT
USING (bucket_id = 'products-images');

-- ุงูุณูุงุญ ููุฃุฏูู ุจุฑูุน ุงูุตูุฑ
CREATE POLICY "ุงูุฃุฏูู ูููููู ุฑูุน ุตูุฑ ุงูููุชุฌุงุช"
ON storage.objects FOR INSERT
WITH CHECK (
  bucket_id = 'products-images' AND
  is_admin(auth.uid())
);

-- ุงูุณูุงุญ ููุฃุฏูู ุจุญุฐู ุงูุตูุฑ
CREATE POLICY "ุงูุฃุฏูู ูููููู ุญุฐู ุตูุฑ ุงูููุชุฌุงุช"
ON storage.objects FOR DELETE
USING (
  bucket_id = 'products-images' AND
  is_admin(auth.uid())
);
```

---

## โ ุงูุชุญูู ูู ูุฌุงุญ ุงูุฅุนุฏุงุฏ

### ุชุญูู ูู ุงูุฌุฏุงูู:

```sql
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
ORDER BY table_name;
```

ูุฌุจ ุฃู ุชุฑู 10 ุฌุฏุงูู.

### ุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงูุซูู:

```sql
SELECT * FROM theme_settings;
```

ูุฌุจ ุฃู ุชุฑู 6 ุฅุนุฏุงุฏุงุช ุฃููุงู.

### ุชุญูู ูู ุงููุณุคูููู:

```sql
SELECT * FROM admins;
```

ูุฌุจ ุฃู ุชุฑู ููุณู ูู ุงููุงุฆูุฉ.

---

## ๐ ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### ุงููุดููุฉ: "function is_admin does not exist"

**ุงูุญู:** ุดุบูู ููู `database-setup.sql` ูุงููุงู ูุฑุฉ ุฃุฎุฑู.

### ุงููุดููุฉ: "permission denied for table X"

**ุงูุญู:** ุชุฃูุฏ ูู ุฃู RLS Policies ุชู ุฅูุดุงุคูุง ุจูุฌุงุญ.

### ุงููุดููุฉ: "duplicate key value violates unique constraint"

**ุงูุญู:** ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ ููุฌูุฏุฉ ูุณุจูุงูุ ูุฐุง ุทุจูุนู. ุชุฌุงูู ุงูุฎุทุฃ.

---

## ๐ ุฅุนุงุฏุฉ ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช (Reset)

โ๏ธ **ุชุญุฐูุฑ:** ูุฐุง ุณูุญุฐู ุฌููุน ุงูุจูุงูุงุช!

```sql
-- ุญุฐู ุฌููุน ุงูุฌุฏุงูู
DROP TABLE IF EXISTS coupon_usage CASCADE;
DROP TABLE IF EXISTS coupons CASCADE;
DROP TABLE IF EXISTS wishlist CASCADE;
DROP TABLE IF EXISTS orders CASCADE;
DROP TABLE IF EXISTS products CASCADE;
DROP TABLE IF EXISTS categories CASCADE;
DROP TABLE IF EXISTS top_bar_messages CASCADE;
DROP TABLE IF EXISTS theme_settings CASCADE;
DROP TABLE IF EXISTS admins CASCADE;
DROP TABLE IF EXISTS profiles CASCADE;

-- ุญุฐู ุงูุฏูุงู
DROP FUNCTION IF EXISTS is_admin(UUID);
DROP FUNCTION IF EXISTS update_updated_at_column();

-- ุงูุขู ุดุบูู database-setup.sql ูุฑุฉ ุฃุฎุฑู
```

---

## ๐ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช (Schema Diagram)

```
โโโโโโโโโโโโโโโ
โ  auth.users โ (ูู Supabase)
โโโโโโโโฌโโโโโโโ
       โ
       โโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโ
       โ          โ          โ          โ          โ
   โโโโโผโโโโ  โโโโผโโโ  โโโโโโผโโโโโ โโโโผโโโ  โโโโโโผโโโโโ
   โadmins โ  โordersโ  โprofiles โ โwishlistโ โcoupon_usageโ
   โโโโโโโโโ  โโโโฌโโโ  โโโโโโโโโโโ โโโโโฌโโโ  โโโโโโฌโโโโโ
                 โ                      โ          โ
            โโโโโโผโโโโโโ           โโโโโผโโโโโ  โโโโผโโโโโโ
            โ products โ           โproductsโ  โcoupons โ
            โโโโโโฌโโโโโโ           โโโโโโโโโโ  โโโโโโโโโโ
                 โ
            โโโโโโผโโโโโโโ
            โcategories โ
            โโโโโโโโโโโโโ
```

---

## ๐ฏ ูุตุงุฆุญ ูููุฉ

1. โ **ุงุญุชูุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงูุชุธุงู
2. โ **ูุง ุชุดุงุฑู** ููุงุชูุญ API ูุน ุฃุญุฏ
3. โ **ุงุณุชุฎุฏู .env.local** ูุญูุธ ุงููุชุบูุฑุงุช ุงูุญุณุงุณุฉ
4. โ **ูุนูู 2FA** ุนูู ุญุณุงุจ Supabase
5. โ **ุฑุงุฌุน ุงูุณูุงุณุงุช** ูุจู ุงููุดุฑ ูู Production

---

## ๐ ููุงุฑุฏ ุฅุถุงููุฉ

- [Supabase Documentation](https://supabase.com/docs)
- [Row Level Security Guide](https://supabase.com/docs/guides/auth/row-level-security)
- [Storage Guide](https://supabase.com/docs/guides/storage)

---

## โจ ุฌุงูุฒ ููุงูุทูุงู!

ุงูุขู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฌุงูุฒุฉ ุชูุงูุงู. ููููู:
- โ ุฅุถุงูุฉ ููุชุฌุงุช
- โ ุฅูุดุงุก ูุฆุงุช
- โ ุฅุฏุงุฑุฉ ุงูุทูุจุงุช
- โ ุชุฎุตูุต ุงูุฃููุงู ูุงูุซูู
- โ ุฅูุดุงุก ููุจููุงุช ุฎุตู

**ุจุงูุชูููู! ๐**
