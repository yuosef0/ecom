# ๐ง ุญู ูุดููุฉ: new row violates row-level security policy

## ๐ ุงููุดููุฉ

ุนูุฏ ูุญุงููุฉ ุฅุถุงูุฉ ููุชุฌ ูู ููุญุฉ ุงูุฃุฏููุ ุชุธูุฑ ูุฐู ุงูุฑุณุงูุฉ:
```
Error: new row violates row-level security policy
```

## ๐ฏ ุงูุณุจุจ

ุณูุงุณุงุช ุงูุฃูุงู (RLS Policies) ูู Supabase ุชููุน ุฅุถุงูุฉ ุงูููุชุฌุงุช. ุงูุณูุงุณุงุช ุงููุฏููุฉ ูุงูุช ููุชูุญุฉ ููุฌููุนุ ููููุง ุงูุขู ุชุญุชุงุฌ ุฅูู ุชุญุฏูุซ ููุณูุงุญ **ููุฃุฏูู ููุท** ุจุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ุงูููุชุฌุงุช.

## โ ุงูุญู (3 ุฎุทูุงุช ููุท)

### ุงูุฎุทูุฉ 1: ุชุฃูุฏ ุฃูู ูุณุฌู ูุฃุฏูู

1. ุงูุชุญ **Supabase Dashboard**
2. ุงุฐูุจ ุฅูู: **SQL Editor**
3. ููุฐ ูุฐุง ุงูุฃูุฑ ููุชุญูู:

```sql
SELECT * FROM admins WHERE email = 'your-email@example.com';
```

**ุฅุฐุง ูู ูุธูุฑ ุดูุก:**
- ุงุชุจุน ุงูุชุนูููุงุช ูู ููู `ADMIN-SETUP-GUIDE.md`
- ุฃู ููุฐ:

```sql
INSERT INTO admins (user_id, email, full_name, role)
SELECT
  id,
  email,
  raw_user_meta_data->>'full_name',
  'super_admin'
FROM auth.users
WHERE email = 'your-email@example.com';
```

ุงุณุชุจุฏู `your-email@example.com` ุจุจุฑูุฏู ุงูุฅููุชุฑููู.

---

### ุงูุฎุทูุฉ 2: ุชุดุบูู ููู ุชุญุฏูุซ ุงูุณูุงุณุงุช

1. ูู **SQL Editor**
2. ุงูุชุญ ููู `update-rls-policies.sql` (ููุฌูุฏ ูู ูุฌูุฏ ุงููุดุฑูุน)
3. **ุงูุณุฎ ูู ูุญุชูู ุงูููู**
4. **ุงูุตูู ูู SQL Editor**
5. **ุงุถุบุท Run** โถ๏ธ
6. ุงูุชุธุฑ ุญุชู ุชุฑู ุฑุณุงูุฉ ุงููุฌุงุญ โ

**ููุงุญุธุฉ:** ูุฐุง ุงูููู ุณูุญุฏุซ ุณูุงุณุงุช ุงูุฃูุงู ูู:
- โ ุงูููุชุฌุงุช (Products)
- โ ุงููุฆุงุช (Categories)
- โ ุงูุทูุจุงุช (Orders)
- โ ุงูููุจููุงุช (Coupons)
- โ ุงูุชููููุงุช (Reviews)

---

### ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุงูุญู

1. **ุณุฌู ุฎุฑูุฌ** ูู ุงููููุน
2. **ุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู** ุจุญุณุงุจ ุงูุฃุฏูู
3. **ุงุฏุฎู ููุญุฉ ุงูุชุญูู** โ **ุงูููุชุฌุงุช**
4. **ุฌุฑุจ ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ**
5. **ูุฌุจ ุฃู ูุนูู ุงูุขู!** ๐

---

## ๐งช ุงุฎุชุจุงุฑ ุณุฑูุน

ุจุนุฏ ุชุดุบูู ุงููููุ ููุฐ ูุฐุง ูู SQL Editor:

```sql
-- ุงุฎุชุจุงุฑ 1: ุชุญูู ูู ุฃูู ุฃุฏูู
SELECT
  email,
  role,
  is_active
FROM admins
WHERE user_id = auth.uid();

-- ูุฌุจ ุฃู ูุธูุฑ ุจุฑูุฏู ูุน role = 'super_admin' ุฃู 'admin'
```

ุฅุฐุง ุธูุฑุช ุจูุงูุงุชูุ ูุนูู ุฐูู ุฃูู ุฃุฏูู ูููููู ุงูุขู ุฅุถุงูุฉ ููุชุฌุงุช.

---

## ๐ ููุฎุต ุงูุณูุงุณุงุช ุงูุฌุฏูุฏุฉ

| ุงูุฌุฏูู | ุงููุฑุงุกุฉ | ุงูุฅุถุงูุฉ | ุงูุชุนุฏูู | ุงูุญุฐู |
|--------|---------|---------|---------|--------|
| **Products** | ุงูุฌููุน โ | ุฃุฏูู ููุท ๐ | ุฃุฏูู ููุท ๐ | ุฃุฏูู ููุท ๐ |
| **Categories** | ุงูุฌููุน โ | ุฃุฏูู ููุท ๐ | ุฃุฏูู ููุท ๐ | ุฃุฏูู ููุท ๐ |
| **Orders** | ุงูุฌููุน โ | ุงูุฌููุน โ | ุฃุฏูู ููุท ๐ | ุฃุฏูู ููุท ๐ |
| **Coupons** | ุงูุฌููุน โ | ุฃุฏูู ููุท ๐ | ุฃุฏูู ููุท ๐ | ุฃุฏูู ููุท ๐ |
| **Reviews** | ุงูุฌููุน โ | ุงูุฌููุน โ | ุฃุฏูู ููุท ๐ | ุฃุฏูู ููุท ๐ |

---

## โ ุฃุณุฆูุฉ ุดุงุฆุนุฉ

### 1. ููุงุฐุง ูุญุชุงุฌ ุงูุนููุงุก ูุฅุถุงูุฉ ุทูุจุงุชุ
ุงูุนููุงุก ูุญุชุงุฌูู ูุฅูุดุงุก ุทูุจุงุช ุนูุฏ ุงูุดุฑุงุกุ ูุฐูู ุงูุฅุถุงูุฉ ูุชุงุญุฉ ููุฌููุน ูู ุฌุฏูู `orders`.

### 2. ููุงุฐุง ูุญุชุงุฌ ุงูุนููุงุก ูุฅุถุงูุฉ ุชููููุงุชุ
ุงูุนููุงุก ูุญุชุงุฌูู ููุชุงุจุฉ ุชููููุงุช ุนูู ุงูููุชุฌุงุชุ ูุฐูู ุงูุฅุถุงูุฉ ูุชุงุญุฉ ููุฌููุน ูู ุฌุฏูู `reviews`.

### 3. ููุงุฐุง ุงููุฑุงุกุฉ ูุชุงุญุฉ ููุฌููุนุ
ุงูุฒูุงุฑ ูุงูุนููุงุก ูุญุชุงุฌูู ููุดุงูุฏุฉ ุงูููุชุฌุงุช ูุงููุฆุงุช ูุจู ุงูุดุฑุงุกุ ูุฐูู ุงููุฑุงุกุฉ ูุชุงุญุฉ ููุฌููุน.

### 4. ูุงุฐุง ูู ูู ููู ุนูุฏู ุฃุฏููุ
ุงุชุจุน ุงูุฎุทูุงุช ูู ููู `ADMIN-SETUP-GUIDE.md` ูุฅุถุงูุฉ ููุณู ูุฃุฏูู ุฃููุงู.

---

## ๐จ ุญู ุงููุดุงูู

### ุงููุดููุฉ: "permission denied for table admins"

**ุงูุญู:**
ุชุฃูุฏ ูู ุชุดุบูู ููู `admins-setup.sql` ุฃููุงู:
```sql
-- ููุฐ ูุฐุง ุงูููู ุฃููุงู
admins-setup.sql
```

### ุงููุดููุฉ: "still getting RLS error after running the file"

**ุงูุญู:**
1. ุงูุณุญ ุงููุงุด ูู ุงููุชุตูุญ (Ctrl+Shift+R)
2. ุณุฌู ุฎุฑูุฌ ูุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู
3. ุชุญูู ูู ุฃูู ุฃุฏูู:
   ```sql
   SELECT * FROM admins WHERE user_id = auth.uid();
   ```

### ุงููุดููุฉ: "auth.uid() returns null"

**ุงูุญู:**
ูุฐุง ูุนูู ุฃูู ูุณุช ูุณุฌู ุฏุฎูู ูู Supabase. ุณุฌู ุฏุฎูู ูู ุงููููุน ุฃููุงูุ ุซู ุฌุฑุจ ูุฑุฉ ุฃุฎุฑู.

---

## ๐ ุงููููุงุช ุฐุงุช ุงูุตูุฉ

- `admins-setup.sql` - ุฅุนุฏุงุฏ ุฌุฏูู ุงูุฃุฏูู
- `update-rls-policies.sql` - ุชุญุฏูุซ ุณูุงุณุงุช RLS (ูุฐุง ุงูููู)
- `ADMIN-SETUP-GUIDE.md` - ุฏููู ุฅุถุงูุฉ ุฃุฏูู
- `supabase-schema.sql` - ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุงูู

---

## โ ุงูุฎูุงุตุฉ

```bash
1. ุชุฃูุฏ ูู ุฅุถุงูุชู ูุฃุฏูู ูู ุฌุฏูู admins
2. ุดุบูู ููู update-rls-policies.sql ูู Supabase
3. ุณุฌู ุฏุฎูู ุจุญุณุงุจ ุงูุฃุฏูู
4. ุฌุฑุจ ุฅุถุงูุฉ ููุชุฌ
5. ุงููุดููุฉ ูุญูููุฉ! ๐
```

---

**ุชูุช ุงูุฅุถุงูุฉ ุจูุฌุงุญ!** ุงูุขู ููููู ุฅุฏุงุฑุฉ ุงููุชุฌุฑ ุจูู ุณูููุฉ ๐
